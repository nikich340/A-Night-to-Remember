#
# quest structure subsegment: finale
# 
# (version: 706, saved: 2020-08-02 00:02:52)
#
---
structure:
  segments:
    finale:
      blocks:
        in:
          ".editor": [ 100.0, 250.0 ]
          next:
            - objective.Inv_Inn: Activate
            - waituntil.side_area
            - waituntil.new_wait_until_realtime_elapsed
        
        scene.house_found_comment:
          ".editor":
            pos: [ 1115.8630371094, 153.2471466064 ]
            in: [ orianna_house_found ]
            out: [ Output ]
          scene: 03.geralt_oneliners.yml
          placement: bob/camp
          interruptable: true
          _fadein: false
          next.Output:
            - objective.Riverside_tracks: Success
            - waituntil.room_are
            - objective.Check_house: Activate
        
        scene.main_orianna_scene:
          ".editor":
            pos: [ 3052.14453125, -66.2440948486 ]
            in: [ Input ]
            out: [ Output, fight ]
          scene: 20.orianna_main.yml
          placement: bob/orianna
          interruptable: true
          _fadein: true
          next.Output:
            - script.new_logmsg
            - objective.wait_outside: Success
          next.fight:
            - waituntil.wait_50perc_health
            - objective.wait_outside: Success
            - objective.KILL_ORIANNA: Activate
            - spawn.spawn_hostile
        
        scene.notes_comment:
          ".editor":
            pos: [ 1958.8635253906, 332.2954101562 ]
            in: [ orianna_house_notes ]
            out: [ Output ]
          scene: 03.geralt_oneliners.yml
          placement: bob/camp
          interruptable: true
          _fadein: false
          next: ".done"
        
        scene.outside_comment:
          ".editor":
            pos: [ 1843.9033203125, 8.3915653229 ]
            in: [ orianna_house_outside ]
            out: [ Output ]
          scene: 03.geralt_oneliners.yml
          placement: bob/camp
          interruptable: true
          _fadein: false
          next.Output:
            - objective.Check_house: Success
            - objective.wait_outside: Activate
        
        scene.room_comment:
          ".editor":
            pos: [ 1450.5578613281, 260.9281005859 ]
            in: [ orianna_house_enter ]
            out: [ Output ]
          scene: 03.geralt_oneliners.yml
          placement: bob/camp
          interruptable: true
          _fadein: false
          next.Output:
            - waituntil.Notes_were_read
        
        scene.scene_orianna_appear:
          ".editor":
            pos: [ 2594.0305175781, 32.824131012 ]
            in: [ Input ]
            out: [ Output ]
          scene: 19.orianna_appear.yml
          placement: bob/orianna
          interruptable: true
          _fadein: true
          next.Output:
            - settime.set_1am
        
        waituntil.1s:
          elapsed: "00:00:01"
          ".editor":
            pos: [ 2914.1823730469, 30.766834259 ]
            in: [ In ]
            out: [ Out ]
          next:
            - script.Play_NTR_music
        
        waituntil.1ss:
          elapsed: "00:00:01"
          ".editor":
            pos: [ 2804.9228515625, -263.2525634766 ]
            in: [ In ]
            out: [ Out ]
          next:
            - script.Set_morph_app
        
        waituntil.1sss:
          elapsed: "00:00:01"
          ".editor":
            pos: [ 2003.064453125, -70.7478637695 ]
            in: [ In ]
            out: [ Out ]
          next:
            - script.Suggest_save
        
        waituntil.2s:
          elapsed: "00:00:02"
          ".editor":
            pos: [ 2245.5146484375, 113.8040924072 ]
            in: [ In ]
            out: [ Out ]
          next:
            - settime.Set_11pm
            - addfact.ntr_finale_started
        
        waituntil.House_area:
          inside: [ bob/house_area, PLAYER ]
          ".editor":
            pos: [ 933.9943237305, 238.903717041 ]
            in: [ In ]
            out: [ Out ]
          next:
            - scene.house_found_comment: orianna_house_found
            - script.Unlock_front_door
        
        waituntil.Notes_were_read:
          factdb: [ BookReadState_ntr_notices_orianna_notes, ">=", 1 ]
          ".editor":
            pos: [ 1656.0227050781, 329.4869995117 ]
            in: [ In ]
            out: [ Out ]
          next:
            - script.new_fact_checker_branch
        
        waituntil.Outside_room:
          outside: [ bob/room_area, PLAYER ]
          ".editor":
            pos: [ 1535.6656494141, 99.9821472168 ]
            in: [ In ]
            out: [ Out ]
          next:
            - scene.outside_comment: orianna_house_outside
            - waituntil.Player_outside
        
        waituntil.Player_outside:
          entered: [ bob/outside_orianna_house, PLAYER ]
          ".editor":
            pos: [ 1948.1547851562, 106.847114563 ]
            in: [ In ]
            out: [ Out ]
          next:
            - script.fade_out
        
        waituntil.footprints_found:
          factdb: [ ntr_orianna_side_footprints_found, ">=", 1 ]
          ".editor":
            pos: [ 675.4466552734, 236.4975891113 ]
            in: [ In ]
            out: [ Out ]
          next:
            - objective.Inv_Inn: Success
            - objective.Riverside_tracks: Activate
            - waituntil.House_area
            - script.focus_ALL_footprints
        
        waituntil.new_wait_until_realtime_elapsed:
          elapsed: "00:00:01"
          ".editor":
            pos: [ 1337.1665039062, 610.9909667969 ]
            in: [ In ]
            out: [ Out ]
          next:
            - waituntil.Player_outside
        
        waituntil.room_are:
          inside: [ bob/room_area, PLAYER ]
          ".editor":
            pos: [ 1312.3793945312, 175.4995269775 ]
            in: [ In ]
            out: [ Out ]
          next:
            - waituntil.Outside_room
            - scene.room_comment: orianna_house_enter
        
        waituntil.side_area:
          inside: [ bob/side_area, PLAYER ]
          ".editor":
            pos: [ 312.7751464844, 249.7742614746 ]
            in: [ In ]
            out: [ Out ]
          next:
            - script.Fcous_first_footprints
        
        waituntil.wait_50perc_health:
          factdb: [ ntr_orianna_vampire_halfhealth, ">=", 1 ]
          ".editor":
            pos: [ 3276.5014648438, 77.0497436523 ]
            in: [ In ]
            out: [ Out ]
          next:
            - script.new_logmsg_1
        
        script.Fcous_first_footprints:
          ".editor":
            pos: [ 496.3221130371, 320.4040527344 ]
            in: [ In ]
            out: [ Out ]
          function: NTR_FocusSetHighlight
          parameter:
            - tag: cname_ntr_orianna_footprints_to_house_first
            - highlightType: FMV_Clue
            - overrideCustomLogic: false
          next:
            - waituntil.footprints_found
        
        script.Play_NTR_music:
          ".editor":
            pos: [ 3083.1977539062, 25.3480796814 ]
            in: [ In ]
            out: [ Out ]
          function: NTR_PlayMusic
          parameter:
            - areaName: toussaint
            - eventName: mus_q704_after_feeding
            - saveType: SESB_DontSave
          next: ".done"
        
        script.Play_beast_music:
          ".editor":
            pos: [ 3305.1533203125, 168.9574432373 ]
            in: [ In ]
            out: [ Out ]
          function: NTR_PlayMusic
          parameter:
            - areaName: toussaint
            - eventName: mus_q704_detlaff_combat_stage02
            - saveType: SESB_Save
          next: ".done"
        
        script.Set_morph_app:
          ".editor":
            pos: [ 2954.4443359375, -185.9756622314 ]
            in: [ In ]
            out: [ Out ]
          function: AppearanceChange
          parameter:
            - npcsTag: cname_ntr_orianna_vampire
            - appearanceName: cname_orianna_human_morph
          next: ".done"
        
        script.Suggest_save:
          ".editor":
            pos: [ 2202.4763183594, -78.9831542969 ]
            in: [ In ]
            out: [ Out ]
          function: ForceManaualSaveQ
          next: ".done"
        
        script.Tune_Orianna:
          ".editor":
            pos: [ 3541.6315917969, 378.7955322266 ]
            in: [ In ]
            out: [ Out ]
          function: NTR_TuneOriannaVampire
          next: ".done"
        
        script.Unlock_front_door:
          ".editor":
            pos: [ 1160.6940917969, 58.4589042664 ]
            in: [ In ]
            out: [ Out ]
          function: NTR_DoorChangeState
          parameter:
            - tag: cname_ntr_orianna_house_front_door
            - newState: EDQS_RemoveLock
          next: ".done"
        
        script.fade_out:
          ".editor":
            pos: [ 2095.1879882812, 23.0984859467 ]
            in: [ In ]
            out: [ Out ]
          function: NTR_FadeOutQuest
          parameter:
            - fadeTime: 2.0
            - r: 0
            - g: 0
            - b: 0
          next:
            - waituntil.2s
        
        script.focus_ALL_footprints:
          ".editor":
            pos: [ 892.7736816406, 133.1155700684 ]
            in: [ In ]
            out: [ Out ]
          function: NTR_FocusSetHighlight
          parameter:
            - tag: cname_ntr_orianna_footprints_to_house
            - highlightType: FMV_Clue
            - overrideCustomLogic: false
          next: ".done"
        
        script.new_fact_checker_branch:
          ".editor":
            pos: [ 1795.6088867188, 408.0973510742 ]
            in: [ In ]
            out: [ "False", "True" ]
          function: NTR_FactChecker
          parameter:
            - factName: ntr_finale_started
            - factCond: "=="
            - val: 1
          next.False:
            - scene.notes_comment: orianna_house_notes
        
        script.new_logmsg:
          ".editor":
            pos: [ 3268.9304199219, -77.7205200195 ]
            in: [ In ]
            out: [ Out ]
          function: radLog
          parameter:
            - logChannel: cname_NTR
            - msg: peaceful
          next:
            - out
        
        script.new_logmsg_1:
          ".editor":
            pos: [ 3497.0014648438, 47.0497322083 ]
            in: [ In ]
            out: [ Out ]
          function: radLog
          parameter:
            - logChannel: cname_NTR
            - msg: HALF HEALTH
          next:
            - out
        
        script.new_show_bossfight_indicator:
          ".editor":
            pos: [ 3301.8051757812, 266.1706237793 ]
            in: [ In ]
            out: [ Out ]
          function: ShowBossFightIndicator
          parameter:
            - enable: true
            - bossTag: cname_ntr_orianna_vampire
          next: ".done"
        
        spawn.Spawn_orianna_vampire:
          ".editor":
            pos: [ 2652.8291015625, -176.9574737549 ]
            hint: spawn-only
            in: []
            out: []
          phase: before_scene
          spawnsets:
            - comm_orianna_vampire
          next:
            - waituntil.1ss
        
        spawn.spawn_hostile:
          ".editor":
            pos: [ 3294.2946777344, 382.1418457031 ]
            hint: spawn-only
            in: []
            out: []
          phase: fight_hostile
          spawnsets:
            - comm_orianna_vampire
          next:
            - script.Tune_Orianna
        
        objective.Check_house:
          ".editor": [ 1292.9097900391, 462.9410705566 ]
          objective: nighttoremember/river_part/check_house
          notify: true
          track: true
          next: ".done"
        
        objective.Inv_Inn:
          ".editor": [ 376.7718811035, 452.561340332 ]
          objective: nighttoremember/river_part/find_house
          notify: true
          track: true
          next: ".done"
        
        objective.KILL_ORIANNA:
          ".editor": [ 3301.6025390625, 490.951171875 ]
          objective: nighttoremember/river_part/kill_orianna
          notify: true
          track: false
          next: ".done"
        
        objective.Riverside_tracks:
          ".editor": [ 956.9162597656, 444.2760620117 ]
          objective: nighttoremember/river_part/follow_tracks
          notify: true
          track: false
          next: ".done"
        
        objective.wait_outside:
          ".editor": [ 2276.61328125, 399.2511901855 ]
          objective: nighttoremember/river_part/wait_outside
          notify: true
          track: false
          next: ".done"
        
        settime.Set_11pm:
          ".editor": [ 2435.9921875, -41.1022186279 ]
          time: "22:30"
          next:
            - spawn.Spawn_orianna_vampire
            - scene.scene_orianna_appear: Input
            - addfact.ntr_finale_started_1
        
        settime.set_1am:
          ".editor": [ 2758.5620117188, -62.9907188416 ]
          time: "00:30"
          next:
            - scene.main_orianna_scene: Input
        
        addfact.ntr_finale_started:
          ".editor": [ 2506.3073730469, 192.5459136963 ]
          value: [ ntr_finale_started, 1 ]
          next: ".done"
        
        addfact.ntr_finale_started_1:
          ".editor": [ 2646.1896972656, -358.2792663574 ]
          value: [ ntr_finale_started, 1 ]
          next: ".done"
        
        out:
          ".editor": [ 3832.4758300781, -1.0440104008 ]
          next: ".done"
        
