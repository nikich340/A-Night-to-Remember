#
# quest structure root segment
# 
# (version: 174, saved: 2020-04-11 23:06:32)
#
---
structure:
  quest:
    blocks:
      start:
        ".editor": [ -4.2857055664, 479.7619018555 ]
        next:
          - changelayers.hide_hide_hide
          - changelayers.show_main_layer
      
      subsegment.intro_part3:
        ".editor":
          pos: [ 5900.0, 25.0 ]
          in: [ In ]
          out: [ Out ]
        segment: intro_part3
        next:
          - end
      
      scene.1_intro_hag:
        ".editor":
          pos: [ 1100.0, 375.0 ]
          in: [ Input ]
          out: [ Output ]
        scene: 1.intro_hag.yml
        placement: bob/introscenes
        interruptable: true
        _fadein: false
        next.Output:
          - waituntil.wait_hag_onDead
      
      scene.2_hag_runs:
        ".editor":
          pos: [ 1500.0, 375.0 ]
          in: [ Input ]
          out: [ Output ]
        scene: 2.intro_hag_runs.yml
        placement: bob/introscenes
        interruptable: true
        _fadein: false
        next.Output:
          - despawn.despawn_hag
      
      scene.3_gp_wall_scene:
        ".editor":
          pos: [ 3300.0, 575.0 ]
          in: [ Input ]
          out: [ Output ]
        scene: 3.gameplay_wall.yml
        placement: bob/introscenes
        interruptable: true
        _fadein: false
        next.Output:
          - script.play_music_invest_suspense
          - objective.blood_tracks: Success
      
      scene.4_triss_appear:
        ".editor":
          pos: [ 3900.0, 525.0 ]
          in: [ Input ]
          out: [ Output ]
        scene: 4.triss_appear.yml
        placement: bob/introscenes
        interruptable: true
        _fadein: false
        next.Output:
          - objective.new_quest_objective_1: Success
          - objective.new_quest_objective: Activate
          - waituntil.new_wait_until_contact_triss
      
      scene.5_triss_to_monster:
        ".editor":
          pos: [ 4300.0, 425.0 ]
          in: [ Input ]
          out: [ Output ]
        scene: 5.triss_to_monster.yml
        placement: bob/introscenes
        interruptable: true
        _fadein: false
        next.Output:
          - changelayers.show_magic
          - objective.new_quest_objective: Success
          - objective.fight_triss: Activate
          - spawn.triss_fight_magic_area
      
      scene.6_triss_barghests:
        ".editor":
          pos: [ 5500.0, 325.0 ]
          in: [ Input ]
          out: [ Output ]
        scene: 6.triss_barghests.yml
        placement: bob/introscenes
        interruptable: true
        _fadein: false
        next.Output:
          - waituntil.outside_magic_barrier
      
      scene.7_gameplay_triss_power:
        ".editor":
          pos: [ 5100.0, 325.0 ]
          in: [ Input ]
          out: [ Output ]
        scene: 7.gameplay_triss_power.yml
        placement: bob/introscenes
        interruptable: false
        _fadein: false
        next: ".done"
      
      waituntil.StopEffects:
        factdb: [ playAllEffectsStop, "=", 0 ]
        ".editor":
          pos: [ -100.0, -150.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - script.PlayAllEffects
      
      waituntil.Triss_out:
        outside: [ bob/magic_area, triss_monster ]
        ".editor":
          pos: [ 4695.734375, -18.5194282532 ]
          in: [ In ]
          out: [ Out ]
        next:
          - script.teleport_triss
      
      waituntil.blood_examined:
        examined: bob/blood_on_wall
        ".editor":
          pos: [ 3100.0, 525.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - spawn.spawn_triss_normal
          - scene.3_gp_wall_scene: Input
      
      waituntil.bloodarea1:
        inside: [ bob/bloodarea1, PLAYER ]
        ".editor":
          pos: [ 2300.0, 225.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - mappin.bloodpin2: Enable
          - mappin.bloodpin1: Disable
      
      waituntil.bloodarea2:
        inside: [ bob/bloodarea2, PLAYER ]
        ".editor":
          pos: [ 2700.0, 425.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - mappin.bloodpin2: Disable
          - mappin.bloodpin3: Enable
      
      waituntil.half_dead:
        factdb: [ trissIntroHalf, ">=", 1 ]
        ".editor":
          pos: [ 4900.0, 425.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - scene.7_gameplay_triss_power: Input
          - waituntil.wait_triss_onDeath
          - script.tune_triss_power
      
      waituntil.if_triss_not_dead:
        factdb: [ trissIntroDead, "=", 0 ]
        ".editor":
          pos: [ 4853.0673828125, 227.4805450439 ]
          in: [ In ]
          out: [ Out ]
        next:
          - despawn.despawn_old_barghests
      
      waituntil.new_wait_until_contact_triss:
        entered: [ bob/triss_contact, PLAYER ]
        ".editor":
          pos: [ 4100.0, 425.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - scene.5_triss_to_monster: Input
      
      waituntil.new_wait_until_fact:
        factdb: [ playMusicStop, "=", 0 ]
        ".editor":
          pos: [ -100.0, -150.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - script.new_scriptcall
      
      waituntil.new_wait_until_inside_area:
        inside: [ bob/bloodarea1, PLAYER ]
        ".editor":
          pos: [ 500.0, -75.0 ]
          in: [ In ]
          out: [ Out ]
        next: ".done"
      
      waituntil.new_wait_until_talked:
        talked: ~triss_monster_test
        ".editor":
          pos: [ -100.0, -150.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - waituntil.new_wait_until_fact
      
      waituntil.outside_magic_barrier:
        outside: [ bob/magic_area, PLAYER ]
        ".editor":
          pos: [ 4700.0, 225.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - waituntil.if_triss_not_dead
      
      waituntil.triss_found_area:
        inside: [ bob/triss_found, PLAYER ]
        ".editor":
          pos: [ 3700.0, 525.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - scene.4_triss_appear: Input
      
      waituntil.wait_1s:
        elapsed: "00:00:01"
        ".editor":
          pos: [ 700.0, 375.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - script.tune_hag
      
      waituntil.wait_1s_2:
        elapsed: "00:00:01"
        ".editor":
          pos: [ 5500.0, 425.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - subsegment.intro_part3
      
      waituntil.wait_1s_3:
        elapsed: "00:00:01"
        ".editor":
          pos: [ 5300.0, 225.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - scene.6_triss_barghests: Input
          - script.tune_barghest_1
          - script.tune_barghest_2
      
      waituntil.wait_3s:
        elapsed: "00:00:03"
        ".editor":
          pos: [ -100.0, -150.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - waituntil.StopEffects
      
      waituntil.wait_hag_onDead:
        factdb: [ hagIntroDead, ">=", 1 ]
        ".editor":
          pos: [ 1300.0, 375.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - scene.2_hag_runs: Input
      
      waituntil.wait_triss_onDeath:
        factdb: [ trissIntroDead, ">=", 1 ]
        ".editor":
          pos: [ 5100.0, 425.0 ]
          in: [ In ]
          out: [ Out ]
        next:
          - despawn.despawn_triss
          - script.hide_triss_indicator
          - script.magic_barrier_deactiv
      
      script.PlayAllEffects:
        ".editor":
          pos: [ -100.0, -150.0 ]
          in: [ In ]
          out: [ Out ]
        function: modPlayAllEffects
        next:
          - waituntil.wait_3s
      
      script.hide_triss_indicator:
        ".editor":
          pos: [ 5300.0, 325.0 ]
          in: [ In ]
          out: [ Out ]
        function: ShowBossFightIndicator
        parameter:
          - enable: false
          - bossTag: cname_triss_monster
        next: ".done"
      
      script.magic_barrier_deactiv:
        ".editor":
          pos: [ 5300.0, 425.0 ]
          in: [ In ]
          out: [ Out ]
        function: PlayEffectQuest
        parameter:
          - entityTag: cname_NTR_magic_barrier1
          - effectName: cname_deactivate
          - activate: true
          - persistentEffect: false
          - deactivateAll: false
          - preventEffectStacking: false
        next:
          - waituntil.wait_1s_2
          - objective.fight_triss: Success
      
      script.magic_barrier_fx:
        ".editor":
          pos: [ 4700.0, 125.0 ]
          in: [ In ]
          out: [ Out ]
        function: PlayEffectQuest
        parameter:
          - entityTag: cname_NTR_magic_barrier1
          - effectName: cname_default
          - activate: true
          - persistentEffect: false
          - deactivateAll: false
          - preventEffectStacking: false
        next: ".done"
      
      script.new_scriptcall:
        ".editor":
          pos: [ -100.0, -150.0 ]
          in: [ In ]
          out: [ Out ]
        function: NTRPlayAllMusic
        next:
          - waituntil.new_wait_until_talked
      
      script.play_music_combat_triss:
        ".editor":
          pos: [ 4700.0, 325.0 ]
          in: [ In ]
          out: [ Out ]
        function: NTRPlayMusic
        parameter:
          - areaName: toussaint
          - eventName: mus_q701_bruxa_combat_loop
        next: ".done"
      
      script.play_music_invest_suspense:
        ".editor":
          pos: [ 3500.0, 525.0 ]
          in: [ In ]
          out: [ Out ]
        function: NTRPlayMusic
        parameter:
          - areaName: toussaint
          - eventName: mus_credits_ep2_secondary
        next:
          - objective.new_quest_objective_1: Activate
          - waituntil.triss_found_area
      
      script.teleport_triss:
        ".editor":
          pos: [ 4694.2548828125, -149.6449890137 ]
          in: [ In ]
          out: [ Out ]
        function: NTR_teleportTriss
        parameter:
          - tag: cname_triss_monster
        next:
          - waituntil.Triss_out
      
      script.triss_indicator:
        ".editor":
          pos: [ 4900.0, 525.0 ]
          in: [ In ]
          out: [ Out ]
        function: ShowBossFightIndicator
        parameter:
          - enable: true
          - bossTag: cname_triss_monster
        next: ".done"
      
      script.tune_barghest_1:
        ".editor":
          pos: [ 5500.0, 225.0 ]
          in: [ In ]
          out: [ Out ]
        function: NTRTuneNPC
        parameter:
          - tag: cname_intro_barghest1
          - level: 990
          - attitude: Hostile
          - mortality: None
          - finishers: false
          - npcGroupType: ENGT_Enemy
          - scale: -1.0
        next: ".done"
      
      script.tune_barghest_2:
        ".editor":
          pos: [ 5500.0, 125.0 ]
          in: [ In ]
          out: [ Out ]
        function: NTRTuneNPC
        parameter:
          - tag: cname_intro_barghest2
          - level: 990
          - attitude: Hostile
          - mortality: None
          - finishers: false
          - npcGroupType: ENGT_Enemy
          - scale: -1.0
        next: ".done"
      
      script.tune_hag:
        ".editor":
          pos: [ 900.0, 375.0 ]
          in: [ In ]
          out: [ Out ]
        function: NTRTuneNPC
        parameter:
          - tag: cname_hag_intro
          - level: 995
          - attitude: Hostile
          - mortality: None
          - finishers: false
          - npcGroupType: ENGT_Enemy
          - scale: -1.0
        next:
          - scene.1_intro_hag: Input
      
      script.tune_triss:
        ".editor":
          pos: [ 4700.0, 475.0 ]
          in: [ In ]
          out: [ Out ]
        function: NTRTuneNPC
        parameter:
          - tag: cname_triss_monster
          - level: 1005
          - attitude: Hostile
          - mortality: None
          - finishers: false
          - npcGroupType: ENGT_Enemy
          - scale: -1.0
        next:
          - script.triss_indicator
          - waituntil.half_dead
      
      script.tune_triss_power:
        ".editor":
          pos: [ 5100.0, 525.0 ]
          in: [ In ]
          out: [ Out ]
        function: NTRTuneNPC
        parameter:
          - tag: cname_triss_monster
          - level: 0
          - attitude: Hostile
          - mortality: None
          - finishers: false
          - npcGroupType: ENGT_Enemy
          - scale: -1.0
        next: ".done"
      
      changelayers.hide_after_triss:
        ".editor":
          pos: [ 4935.0, 138.4999847412 ]
          hint: hide-only
          in: []
          out: []
        sync: true
        purge: false
        world: bob
        hide:
          - after_triss_to_monster
        next:
          - subsegment.intro_part3
      
      changelayers.hide_hide_hide:
        ".editor":
          pos: [ 176.6666717529, 571.6666870117 ]
          hint: hide-only
          in: []
          out: []
        sync: true
        purge: false
        world: bob
        hide:
          - after_hag
          - after_triss_to_monster
        next: ".done"
      
      changelayers.show_blood_tracks:
        ".editor":
          pos: [ 1900.0, 375.0 ]
          hint: show-only
          in: []
          out: []
        sync: true
        purge: false
        world: bob
        show:
          - after_hag
        next:
          - journal.journal_entry_intro_hag: Activate
          - objective.blood_tracks: Activate
          - mappin.bloodpin1: Enable
          - mappin.bloodpin2: Disable
          - mappin.bloodpin3: Disable
      
      changelayers.show_magic:
        ".editor":
          pos: [ 4500.0, 225.0 ]
          hint: show-only
          in: []
          out: []
        sync: true
        purge: false
        world: bob
        show:
          - after_triss_to_monster
        next:
          - waituntil.outside_magic_barrier
          - script.play_music_combat_triss
          - script.magic_barrier_fx
          - waituntil.Triss_out
      
      changelayers.show_main_layer:
        ".editor":
          pos: [ 201.9047698975, 406.4285888672 ]
          hint: show-only
          in: []
          out: []
        sync: true
        purge: false
        world: bob
        show:
          - nlayer
        next:
          - settime.set_21am
      
      spawn.spawn_intro_hag:
        ".editor":
          pos: [ 500.0, 375.0 ]
          hint: spawn-only
          in: []
          out: []
        phase: hag_intro_fight
        spawnsets:
          - comm_hag
        next:
          - waituntil.wait_1s
      
      spawn.spawn_new_barghests:
        ".editor":
          pos: [ 5142.6665039062, 225.6666717529 ]
          hint: spawn-only
          in: []
          out: []
        phase: barghests_fight
        spawnsets:
          - comm_barghests
        next:
          - waituntil.wait_1s_3
      
      spawn.spawn_triss_normal:
        ".editor":
          pos: [ 3300.0, 475.0 ]
          hint: spawn-only
          in: []
          out: []
        phase: normal
        spawnsets:
          - comm_triss
        next: ".done"
      
      spawn.triss_fight_magic_area:
        ".editor":
          pos: [ 4500.0, 475.0 ]
          hint: spawn-only
          in: []
          out: []
        phase: fight
        spawnsets:
          - comm_triss
        next:
          - script.tune_triss
      
      despawn.despawn_hag:
        ".editor":
          pos: [ 1700.0, 375.0 ]
          hint: despawn-only
          in: []
          out: []
        spawnsets:
          - comm_hag
        next:
          - changelayers.show_blood_tracks
      
      despawn.despawn_old_barghests:
        ".editor":
          pos: [ 4988.6665039062, 229.0 ]
          hint: despawn-only
          in: []
          out: []
        spawnsets:
          - comm_barghests
        next:
          - spawn.spawn_new_barghests
      
      despawn.despawn_triss:
        ".editor":
          pos: [ 5300.0, 525.0 ]
          hint: despawn-only
          in: []
          out: []
        spawnsets:
          - comm_triss
        next: ".done"
      
      journal.journal_entry_intro_hag:
        ".editor": [ 2100.0, 325.0 ]
        entry: quests/nighttoremember/intro_hag1
        notify: true
        activate_root: true
        next: ".done"
      
      objective.blood_tracks:
        ".editor": [ 2600.9091796875, 809.5454711914 ]
        objective: nighttoremember/intro_hag/blood_tracks
        notify: true
        track: true
        next: ".done"
      
      objective.fight_triss:
        ".editor": [ 5013.6362304688, 823.1817626953 ]
        objective: nighttoremember/intro_triss/fight_triss
        notify: false
        track: false
        next: ".done"
      
      objective.new_quest_objective:
        ".editor": [ 4107.2729492188, 817.7272949219 ]
        objective: nighttoremember/intro_triss/talk_triss
        notify: true
        track: true
        next: ".done"
      
      objective.new_quest_objective_1:
        ".editor": [ 3669.0910644531, 834.9999389648 ]
        objective: nighttoremember/intro_hag/blood_tracks_wall
        notify: true
        track: true
        next: ".done"
      
      mappin.bloodpin1:
        ".editor": [ 2100.0, 225.0 ]
        mappin: nighttoremember/intro_hag/blood_tracks/bloodpin1
        next:
          - waituntil.bloodarea1
      
      mappin.bloodpin2:
        ".editor": [ 2500.0, 425.0 ]
        mappin: nighttoremember/intro_hag/blood_tracks/bloodpin2
        next:
          - waituntil.bloodarea2
      
      mappin.bloodpin3:
        ".editor": [ 2900.0, 525.0 ]
        mappin: nighttoremember/intro_hag/blood_tracks/bloodpin3
        next:
          - waituntil.blood_examined
      
      settime.set_21am:
        ".editor": [ 312.0238037109, 304.7619018555 ]
        time: "21:00"
        next:
          - spawn.spawn_intro_hag
      
      end:
        ".editor": [ 6100.0, 25.0 ]
        next: ".done"
      
