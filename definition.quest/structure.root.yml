#
# quest structure root segment
# 
# (version: 438, saved: 2020-07-07 22:21:21)
#
---
structure:
  quest:
    blocks:
      start:
        ".editor": [ -407.4636230469, 482.2406005859 ]
        next:
          - waituntil.wait_quest_allowed
          - changelayers.hide_hide_hide
      
      subsegment.camp:
        ".editor":
          pos: [ 1196.6180419922, 486.6039428711 ]
          in: [ In ]
          out: [ Out ]
        segment: camp
        next:
          - end
      
      subsegment.intro_nightmare:
        ".editor":
          pos: [ 237.6061553955, 504.0928955078 ]
          in: [ In ]
          out: [ Out ]
        segment: intro_nightmare
        next:
          - subsegment.regis_mail
      
      subsegment.orphanage:
        ".editor":
          pos: [ 790.9936523438, 491.5223693848 ]
          in: [ In ]
          out: [ Out ]
        segment: orphanage
        next:
          - changelayers.show_camp_maybe_at_start
      
      subsegment.regis_mail:
        ".editor":
          pos: [ 452.4227905273, 503.7007141113 ]
          in: [ In ]
          out: [ Out ]
        segment: regis_mail
        next:
          - changelayers.show_orphlayer
      
      waituntil.midnight:
        time: [ "00:00", "01:00" ]
        ".editor":
          pos: [ 1237.7524414062, 928.6041259766 ]
          in: [ In ]
          out: [ Out ]
        next:
          - script.check_camp_removed2
      
      waituntil.night_time:
        time: [ "00:00", "04:00" ]
        ".editor":
          pos: [ 491.9230041504, -245.4349060059 ]
          in: [ In ]
          out: [ Out ]
        next:
          - addfact.fact_add11
      
      waituntil.non_night_time:
        time: [ "04:01", "23:59" ]
        ".editor":
          pos: [ 622.0083618164, -81.7935943604 ]
          in: [ In ]
          out: [ Out ]
        next:
          - addfact.del_fact11
      
      waituntil.outside_area:
        outside: [ bob/orphanage_wraitharea, PLAYER ]
        ".editor":
          pos: [ 754.7053222656, 222.8629760742 ]
          in: [ In ]
          out: [ Out ]
        next:
          - addfact.del_fact1
      
      waituntil.time_brake:
        time: [ "01:01", "23:59" ]
        ".editor":
          pos: [ 1447.5114746094, 881.4168701172 ]
          in: [ In ]
          out: [ Out ]
        next:
          - waituntil.midnight
      
      waituntil.wait_day:
        time: [ "08:01", "23:59" ]
        ".editor":
          pos: [ 1490.1114501953, 794.9918823242 ]
          in: [ In ]
          out: [ Out ]
        next:
          - spawnsets.camp_axe_day
      
      waituntil.wait_night:
        time: [ "00:00", "08:00" ]
        ".editor":
          pos: [ 1401.6700439453, 671.875 ]
          in: [ In ]
          out: [ Out ]
        next:
          - script.check_camp_removed
      
      waituntil.wait_quest_allowed:
        factdb: [ NTRstartquest, ">=", 1 ]
        ".editor":
          pos: [ -200.99609375, 487.9546813965 ]
          in: [ In ]
          out: [ Out ]
        next:
          - changelayers.show_main_layer
      
      waituntil.wraith_area:
        inside: [ bob/orphanage_wraitharea, PLAYER ]
        ".editor":
          pos: [ 636.0413818359, 94.8574752808 ]
          in: [ In ]
          out: [ Out ]
        next:
          - addfact.fact_add1
      
      script.FACT_BRANCH:
        ".editor":
          pos: [ 983.391418457, -65.5462341309 ]
          in: [ In ]
          out: [ "False", "True" ]
        function: NTR_FactChecker
        parameter:
          - factName: NTR_orphanage_wraith
          - factCond: "=="
          - val: 2
        next.True:
          - spawn.spawn_wraiths
      
      script.FACT_BRANCH1:
        ".editor":
          pos: [ 429.0227966309, -69.3067398071 ]
          in: [ In ]
          out: [ "False", "True" ]
        function: NTR_FactChecker
        parameter:
          - factName: NTR_orphanage_wraith
          - factCond: "=="
          - val: 2
        next.False:
          - waituntil.non_night_time
      
      script.FACT_BRANCH2:
        ".editor":
          pos: [ 541.5682373047, 226.8706359863 ]
          in: [ In ]
          out: [ "False", "True" ]
        function: NTR_FactChecker
        parameter:
          - factName: NTR_orphanage_wraith
          - factCond: "=="
          - val: 2
        next.False:
          - waituntil.outside_area
      
      script.check_camp_removed:
        ".editor":
          pos: [ 1606.5925292969, 669.5978393555 ]
          in: [ In ]
          out: [ "False", "True" ]
        function: NTR_FactChecker
        parameter:
          - factName: ntr_remove_camp
          - factCond: "=="
          - val: 1
        next.False:
          - spawnsets.camp_axe_night
      
      script.check_camp_removed2:
        ".editor":
          pos: [ 1391.9036865234, 1000.1749267578 ]
          in: [ In ]
          out: [ "False", "True" ]
        function: NTR_FactChecker
        parameter:
          - factName: ntr_remove_camp
          - factCond: "=="
          - val: 1
        next.False:
          - script.teleport_horse1
          - script.teleport_horse2
          - script.teleport_horse3
          - script.teleport_horse_baron
      
      script.sounds_dettlaff:
        ".editor":
          pos: [ 137.6712799072, 377.7290344238 ]
          in: [ In ]
          out: [ Out ]
        function: playSoundsCustom
        next: ".done"
      
      script.teleport_horse1:
        ".editor":
          pos: [ 1611.5767822266, 1104.3579101562 ]
          in: [ In ]
          out: [ Out ]
        function: NTR_teleportToNode
        parameter:
          - tag: cname_ntr_camp_horse1
          - tagNode: cname_ntr_bob_horse1_parked_ap
          - applyRotation: true
        next:
          - waituntil.time_brake
      
      script.teleport_horse2:
        ".editor":
          pos: [ 1617.9165039062, 1183.7696533203 ]
          in: [ In ]
          out: [ Out ]
        function: NTR_teleportToNode
        parameter:
          - tag: cname_ntr_camp_horse2
          - tagNode: cname_ntr_bob_horse2_parked_ap
          - applyRotation: true
        next: ".done"
      
      script.teleport_horse3:
        ".editor":
          pos: [ 1623.7990722656, 1261.6782226562 ]
          in: [ In ]
          out: [ Out ]
        function: NTR_teleportToNode
        parameter:
          - tag: cname_ntr_camp_horse3
          - tagNode: cname_ntr_bob_horse3_parked_ap
          - applyRotation: true
        next: ".done"
      
      script.teleport_horse_baron:
        ".editor":
          pos: [ 1628.5048828125, 1340.5668945312 ]
          in: [ In ]
          out: [ Out ]
        function: NTR_teleportToNode
        parameter:
          - tag: cname_ntr_camp_horse_baron
          - tagNode: cname_ntr_bob_horse_baron_parked_ap
          - applyRotation: true
        next: ".done"
      
      changelayers.hide_hide_hide:
        ".editor":
          pos: [ -209.238067627, 576.571472168 ]
          hint: hide-only
          in: []
          out: []
        sync: true
        purge: false
        world: bob
        hide:
          - after_hag
          - after_triss_to_monster
          - owl_layer
          - orphanage_layer
        next: ".done"
      
      changelayers.show_camp_maybe_at_start:
        ".editor":
          pos: [ 994.1068115234, 596.6958618164 ]
          hint: show-only
          in: []
          out: []
        sync: true
        purge: false
        world: bob
        show:
          - camp_layer
        next:
          - subsegment.camp
          - spawnsets.camp_axe_day
          - waituntil.midnight
      
      changelayers.show_main_layer:
        ".editor":
          pos: [ 35.415599823, 615.2749633789 ]
          hint: show-only
          in: []
          out: []
        sync: true
        purge: false
        world: bob
        show:
          - nlayer
        next:
          - changelayers.show_camp_maybe_at_start
      
      changelayers.show_orphlayer:
        ".editor":
          pos: [ 621.4846801758, 414.8437194824 ]
          hint: show-only
          in: []
          out: []
        sync: true
        purge: false
        world: bob
        show:
          - orphanage_layer
        next:
          - subsegment.orphanage
          - waituntil.wraith_area
          - waituntil.night_time
      
      spawnsets.camp_axe_day:
        ".editor":
          pos: [ 1225.2901611328, 660.7208251953 ]
          hint: both
          in: []
          out: []
        phase: usual_day
        spawn:
          - comm_camp_bandit_axe_day
        despawn:
          - comm_camp_bandit_axe_night
        next:
          - waituntil.wait_night
      
      spawnsets.camp_axe_night:
        ".editor":
          pos: [ 1278.619140625, 812.3809204102 ]
          hint: both
          in: []
          out: []
        phase: patrolling_night
        spawn:
          - comm_camp_bandit_axe_night
        despawn:
          - comm_camp_bandit_axe_day
        next:
          - waituntil.wait_day
      
      spawn.spawn_wraiths:
        ".editor":
          pos: [ 1168.5069580078, -23.5438270569 ]
          hint: spawn-only
          in: []
          out: []
        phase: fight
        spawnsets:
          - comm_orph_wraiths
        next: ".done"
      
      addfact.del_fact1:
        ".editor": [ 952.7802734375, 217.9209899902 ]
        value: [ NTR_orphanage_wraith, -1 ]
        next:
          - waituntil.wraith_area
      
      addfact.del_fact11:
        ".editor": [ 811.9638671875, -80.3769302368 ]
        value: [ NTR_orphanage_wraith, -1 ]
        next:
          - waituntil.night_time
      
      addfact.fact_add1:
        ".editor": [ 824.43359375, 89.9456558228 ]
        value: [ NTR_orphanage_wraith, 1 ]
        next:
          - script.FACT_BRANCH2
          - script.FACT_BRANCH
      
      addfact.fact_add11:
        ".editor": [ 791.5753173828, -239.6225128174 ]
        value: [ NTR_orphanage_wraith, 1 ]
        next:
          - script.FACT_BRANCH
          - script.FACT_BRANCH1
      
      end:
        ".editor": [ 1442.3725585938, 489.039855957 ]
        next: ".done"
      
